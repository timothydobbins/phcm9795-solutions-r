[["module-7-solutions-to-learning-activities.html", "Module 7: Solutions to Learning Activities", " Module 7: Solutions to Learning Activities Activity 7.1 Use the file Activity_S7.1.rds to further investigate whether there is a gender difference in asthma in a random sample of 514 upper primary school children: Use a contingency table (cross-tabulation) to determine the observed and expected frequencies. Which cell has the lowest expected cell count? Here we can use the contTables() function within jmv with the option exp = TRUE to present the expected frequencies. library(jmv) children &lt;- readRDS(&quot;data/activities/Activity_S7.1.rds&quot;) contTables(data=children, rows = gender, cols = asthma, exp = TRUE) ## ## CONTINGENCY TABLES ## ## Contingency Tables ## ─────────────────────────────────────────────────────────── ## gender No Yes Total ## ─────────────────────────────────────────────────────────── ## Female Observed 196 46 242 ## Expected 185.8560 56.14400 242.0000 ## ## Male Observed 188 70 258 ## Expected 198.1440 59.85600 258.0000 ## ## Total Observed 384 116 500 ## Expected 384.0000 116.00000 500.0000 ## ─────────────────────────────────────────────────────────── ## ## ## χ² Tests ## ───────────────────────────────────── ## Value df p ## ───────────────────────────────────── ## χ² 4.624920 1 0.0315107 ## N 500 ## ───────────────────────────────────── In the table, cell “b” (asthma symptoms among females) gives the lowest expected frequency which is 56.1 - much larger than 5. Therefore, we can conduct a Pearson’s chi-square test. Use a chi-squared test to evaluate the hypothesis and interpret the result. Are the assumptions for a chi-squared test met? Calculate the 95% CI of the difference in proportions. Note the table above has asthma symptoms with the “No” level appearing first. To estimate the difference in the proportion with asthma symptoms, we should re-order the asthma factor so that “Yes” appears first. str(children$asthma) ## Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 1 1 2 1 1 2 2 2 1 ... ## - attr(*, &quot;label&quot;)= chr &quot;Asthma symptoms&quot; children$asthma &lt;- relevel(children$asthma, ref=&quot;Yes&quot;) str(children$asthma) ## Factor w/ 2 levels &quot;Yes&quot;,&quot;No&quot;: 1 2 2 1 2 2 1 1 1 2 ... We can now request a contingency table with row-percents using pcRow = TRUE and diffProp to request the difference in proportions. contTables(data=children, rows = gender, cols = asthma, pcRow = TRUE, diffProp = TRUE) ## ## CONTINGENCY TABLES ## ## Contingency Tables ## ───────────────────────────────────────────────────────────────── ## gender Yes No Total ## ───────────────────────────────────────────────────────────────── ## Female Observed 46 196 242 ## % within row 19.00826 80.99174 100.00000 ## ## Male Observed 70 188 258 ## % within row 27.13178 72.86822 100.00000 ## ## Total Observed 116 384 500 ## % within row 23.20000 76.80000 100.00000 ## ───────────────────────────────────────────────────────────────── ## ## ## χ² Tests ## ───────────────────────────────────── ## Value df p ## ───────────────────────────────────── ## χ² 4.624920 1 0.0315107 ## N 500 ## ───────────────────────────────────── ## ## ## Comparative Measures ## ────────────────────────────────────────────────────────────────────────────── ## Value Lower Upper ## ────────────────────────────────────────────────────────────────────────────── ## Difference in 2 proportions -0.08123518 ᵃ -0.1546347 -0.007835685 ## ────────────────────────────────────────────────────────────────────────────── ## ᵃ Rows compared The P value is 0.032 from the Chi-Square value of 4.62 with 1 df, which provides evidence of a difference in the proportions diagnosed with asthma between males and females. There are four assumptions for a Pearson’s chi-squared test: each observation must be independent each participant is represented in the table once only at least 80% of the expected cell counts should exceed a value of five all expected cell counts should exceed a value of one. It is evident from the study design that the observations are independent, and each participant was presented in the table once only (asthma was measured once only). Therefore, the first two assumptions are met. From part (a), we can see that smallest expected cell count is 56.1 (&gt;5). Thus, the last two assumptions are also met. The proportion of asthma is 27.1% among males and 19.0% among females. There is evidence of a difference in the proportions diagnosed with asthma between males and females (chi-square=4.62 with 1 df, P=0.03). The proportion with asthma is 8.0% lower in females than males with a 95% confidence interval of 0.8% to 15.5% (read from the Risk difference). Activity 7.2 The file Activity_S7.2.rds summarises the 5-year mortality data for 89 people who did or did not have a heart attack. State the null hypothesis. Null hypothesis: There is no association between having a heart attack and risk of death in the next five years Using Stata, carry out the appropriate significance test to evaluate the hypothesis. Do the data fulfil the assumptions of the statistical test you have used? A Pearson’s Chi-Square test is appropriate to test the null hypothesis. To check whether our data fulfils the assumptions for a Pearson’s Chi-Squared test we need to obtain the expected frequencies for the 2 × 2 table using cross-tabulation: heart &lt;- readRDS(&quot;data/activities/Activity_S7.2.rds&quot;) head(heart) ## survival heart_attack mort ## 1 No yes yes ## 2 No yes yes ## 3 No yes yes ## 4 No yes yes ## 5 No yes yes ## 6 No yes yes str(heart) ## &#39;data.frame&#39;: 89 obs. of 3 variables: ## $ survival : Factor w/ 2 levels &quot;No&quot;,&quot;yes&quot;: 1 1 1 1 1 1 1 1 1 1 ... ## ..- attr(*, &quot;label&quot;)= chr &quot;Survival&quot; ## $ heart_attack: Factor w/ 2 levels &quot;No&quot;,&quot;yes&quot;: 2 2 2 2 2 2 2 2 2 2 ... ## ..- attr(*, &quot;label&quot;)= chr &quot;Heart_attack&quot; ## $ mort : Factor w/ 2 levels &quot;No&quot;,&quot;yes&quot;: 2 2 2 2 2 2 2 2 2 2 ... ## ..- attr(*, &quot;label&quot;)= chr &quot;Death&quot; We can see that each variable has been entered as a factor, but “No” is the first level. We should reorder our exposure (heart_attack) and outcome (mort) so that “yes” becomes the first level: heart$heart_attack &lt;- relevel(heart$heart_attack, ref=&quot;yes&quot;) heart$mort &lt;- relevel(heart$mort, ref=&quot;yes&quot;) str(heart) ## &#39;data.frame&#39;: 89 obs. of 3 variables: ## $ survival : Factor w/ 2 levels &quot;No&quot;,&quot;yes&quot;: 1 1 1 1 1 1 1 1 1 1 ... ## ..- attr(*, &quot;label&quot;)= chr &quot;Survival&quot; ## $ heart_attack: Factor w/ 2 levels &quot;yes&quot;,&quot;No&quot;: 1 1 1 1 1 1 1 1 1 1 ... ## $ mort : Factor w/ 2 levels &quot;yes&quot;,&quot;No&quot;: 1 1 1 1 1 1 1 1 1 1 ... We can now use contTables() to produce the 2-by-2 table with expected values: contTables(data=heart, rows=heart_attack, cols=mort, exp=TRUE) ## ## CONTINGENCY TABLES ## ## Contingency Tables ## ───────────────────────────────────────────────────────────────── ## heart_attack yes No Total ## ───────────────────────────────────────────────────────────────── ## yes Observed 10 35 45 ## Expected 7.584270 37.41573 45.00000 ## ## No Observed 5 39 44 ## Expected 7.415730 36.58427 44.00000 ## ## Total Observed 15 74 89 ## Expected 15.000000 74.00000 89.00000 ## ───────────────────────────────────────────────────────────────── ## ## ## χ² Tests ## ───────────────────────────────────── ## Value df p ## ───────────────────────────────────── ## χ² 1.871883 1 0.1712595 ## N 89 ## ───────────────────────────────────── From the study design, it is clear that the observations are independent, and participants are represented only once in the table. Therefore, the data fulfils the first two assumptions of independence. From the above table we can see that the lowest expected frequency is 7.4, which is greater than 5. Thus, the last two assumptions are also met, and we can use the results from the Pearson’s Chi-Squared test. The P-value from the Chi-Square test (chi-square = 1.87 with 1 df) test statistic is 0.17, that is, there is no evidence of an association between heart attack and mortality during the next 5 years. Estimate the appropriate risk estimate for mortality. Are the confidence intervals of the risk estimates consistent with the P value? Because this is a follow-up study from where we can estimate incidence, the relative risk is the appropriate risk estimate: contTables(data=heart, rows=heart_attack, cols=mort, pcRow = TRUE, relRisk = TRUE) ## ## CONTINGENCY TABLES ## ## Contingency Tables ## ─────────────────────────────────────────────────────────────────────── ## heart_attack yes No Total ## ─────────────────────────────────────────────────────────────────────── ## yes Observed 10 35 45 ## % within row 22.22222 77.77778 100.00000 ## ## No Observed 5 39 44 ## % within row 11.36364 88.63636 100.00000 ## ## Total Observed 15 74 89 ## % within row 16.85393 83.14607 100.00000 ## ─────────────────────────────────────────────────────────────────────── ## ## ## χ² Tests ## ───────────────────────────────────── ## Value df p ## ───────────────────────────────────── ## χ² 1.871883 1 0.1712595 ## N 89 ## ───────────────────────────────────── ## ## ## Comparative Measures ## ──────────────────────────────────────────────────────── ## Value Lower Upper ## ──────────────────────────────────────────────────────── ## Relative risk 1.955556 ᵃ 0.7267615 5.261971 ## ──────────────────────────────────────────────────────── ## ᵃ Rows compared The relative risk is 1.96 (95% CI: 0.73, 5.26). The confidence interval includes the null value (1) which is consistent with the P-value (P = 0.17). Note that the risk difference would also be an acceptable measure for this study. Summarise your results and state your conclusion. There is no evidence of an association between heart attack and 5-year mortality (chi-square=1.87 with 1 df, P = 0.17). The risk of dying during next 5 years for those who experienced a heart attack is 1.96 (95% CI: 0.73, 5.26) times that for those who did not experience a heart attack, but the 95% confidence interval indicates that the relative risk may be as low as 0.73 and as high as 5.26 (with 95% confidence). Activity 7.3 The effect of two penicillin allergens B and G was tested in a random sample of 500 people. All people were tested with both allergens. For each person, data were recorded for whether or not there was an allergic reaction to the allergen. Use the data set Activity_S7.3.rds to test the null hypothesis that the proportion of participants who react to allergen G is the same as the proportion who react to allergen B. Are the 95% CI around the difference consistent with the P value? As usual, after reading the data, we should check the ordering of the factor levels for the two variables. study &lt;- readRDS(&quot;data/activities/Activity_S7.3.rds&quot;) head(study) ## React_Allergen_G React_Allergen_B ## 1 React React ## 2 React React ## 3 React React ## 4 React React ## 5 React React ## 6 React React str(study) ## &#39;data.frame&#39;: 500 obs. of 2 variables: ## $ React_Allergen_G: Factor w/ 2 levels &quot;Don&#39;t react&quot;,..: 2 2 2 2 2 2 2 2 2 2 ... ## ..- attr(*, &quot;label&quot;)= chr &quot;Reacts to allergen G&quot; ## $ React_Allergen_B: Factor w/ 2 levels &quot;Don&#39;t react&quot;,..: 2 2 2 2 2 2 2 2 2 2 ... ## ..- attr(*, &quot;label&quot;)= chr &quot;Reacts to allergen B&quot; It’s a little difficult to determine the order from this output, so let’s look at a table: table(study$React_Allergen_B) ## ## Don&#39;t react React ## 432 68 table(study$React_Allergen_G) ## ## Don&#39;t react React ## 448 52 In both cases, “Don’t react” is the first level. This should be re-ordered: study$React_Allergen_B &lt;- relevel(study$React_Allergen_B, ref=&quot;React&quot;) study$React_Allergen_G &lt;- relevel(study$React_Allergen_G, ref=&quot;React&quot;) Because the data are paired, McNemar’s test should be used to test the null hypothesis using the contTablesPaired() function: contTablesPaired(data=study, rows=React_Allergen_B, cols=React_Allergen_G) ## ## PAIRED SAMPLES CONTINGENCY TABLES ## ## Contingency Tables ## ───────────────────────────────────────────────────── ## React_Allergen_B React Don&#39;t react Total ## ───────────────────────────────────────────────────── ## React 40 28 68 ## Don&#39;t react 12 420 432 ## Total 52 448 500 ## ───────────────────────────────────────────────────── ## ## ## McNemar Test ## ───────────────────────────────────── ## Value df p ## ───────────────────────────────────── ## χ² 6.400000 1 0.0114120 ## N 500 ## ───────────────────────────────────── We use the mcNemarDiff() function (stored in Microsoft Teams and here) to estimate the proportions, the difference in proportions and its 95% confidence interval. We should copy the function and paste it into R. Note that when defining the variables to be summarised, the variable names must be surrounded by quotation marks. ### Copied from Microsoft Teams mcNemarDiff &lt;- function(data, var1, var2, digits = 3) { if (!requireNamespace(&quot;epibasix&quot;, quietly = TRUE)) { stop(&quot;This function requires epibasix to be installed&quot;) } tab &lt;- table(data[[var1]], data[[var2]]) p1 &lt;- (tab[1, 1] + tab[1, 2]) / sum(tab) p2 &lt;- (tab[1, 1] + tab[2, 1]) / sum(tab) pd &lt;- epibasix::mcNemar(tab)$rd pd.cil &lt;- epibasix::mcNemar(tab)$rd.CIL pd.ciu &lt;- epibasix::mcNemar(tab)$rd.CIU print(paste0( &quot;Proportion 1: &quot;, format(round(p1, digits = digits), nsmall = digits), &quot;; Proportion 2: &quot;, format(round(p2, digits = digits), nsmall = digits) )) print(paste0( &quot;Difference in paired proportions: &quot;, format(round(pd, digits = digits), nsmall = digits), &quot;; 95% CI: &quot;, format(round(pd.cil, digits = digits), nsmall = digits), &quot; to &quot;, format(round(pd.ciu, digits = digits), nsmall = digits) )) } ### End copy mcNemarDiff(data = study, var1 = &quot;React_Allergen_B&quot;, var2 = &quot;React_Allergen_G&quot;, digits = 3) ## [1] &quot;Proportion 1: 0.136; Proportion 2: 0.104&quot; ## [1] &quot;Difference in paired proportions: 0.032; 95% CI: 0.005 to 0.059&quot; The McNemar’s test result shows evidence of a difference in reactions to allergens B and G (chi-square=6.40 with 1 df, P = 0.011). The output from the mcNemarDiff() function shows that 13.6% of participants react to allergen B and 10.4% of participants react to allergen G, with the difference in reaction rate of 3.2% (95% CI: 0.5% to 5.9%). The 95% CI does not include the null value (which is 0), which is consistent with the P-value being less than 0.05 (P = 0.017). Therefore, we can conclude that there is evidence (P = 0.017) of a difference in the effect of penicillin allergen B and G. A total of 3.2% more patients reacted to penicillin B (13.6%) compared to penicillin G (10.4%), and we are 95% confident that the true difference in the underlying population is between 0.5% and 5.9%. Activity 7.4 We examined a survey of 200 live births in an urban region in which 2 babies were born prematurely. We also surveyed 80 live births in a rural region and found that 5 babies were born prematurely. Conduct an appropriate statistical analysis to find out whether the proportion of premature births is higher in the rural region. Two cross-sectional surveys were conducted in two different regions (urban and rural), thus the data are independent and each participant appeared in the dataset only once. We need to check the expected frequencies in a 2x2 table to determine if a Pearson’s chi-square test or a Fisher’s exact test is appropriate. The data are aggregate, so we need to enter them into R. To produce the required information for the 2x2 table, we need to calculate total number of normal births in each survey by subtracting the number of premature births from the total births. Thus, in the urban area there are 200 − 2 = 198 normal births and in the rural area there are 80 – 5 = 75 normal births. The data should be entered in the following way: babies &lt;- data.frame( region = c(&quot;Urban&quot;, &quot;Urban&quot;, &quot;Rural&quot;, &quot;Rural&quot;), birth = c(&quot;Premature&quot;, &quot;Not premature&quot;, &quot;Premature&quot;, &quot;Not premature&quot;), n = c(2, 198, 5, 75) ) babies$region &lt;- factor(babies$region, levels=c(&quot;Urban&quot;, &quot;Rural&quot;)) babies$birth &lt;- factor(babies$birth, levels=c(&quot;Premature&quot;, &quot;Not premature&quot;)) babies ## region birth n ## 1 Urban Premature 2 ## 2 Urban Not premature 198 ## 3 Rural Premature 5 ## 4 Rural Not premature 75 We can use contTables() to calculate the expected counts in each cell. As we are using aggregate data, we must use counts = n to specify that the column n contains the counts. contTables(data=babies, rows = region, cols = birth, counts = n, exp = TRUE) ## ## CONTINGENCY TABLES ## ## Contingency Tables ## ───────────────────────────────────────────────────────────────── ## region Premature Not premature Total ## ───────────────────────────────────────────────────────────────── ## Urban Observed 2 198 200 ## Expected 5.000000 195.00000 200.00000 ## ## Rural Observed 5 75 80 ## Expected 2.000000 78.00000 80.00000 ## ## Total Observed 7 273 280 ## Expected 7.000000 273.00000 280.00000 ## ───────────────────────────────────────────────────────────────── ## ## ## χ² Tests ## ───────────────────────────────────── ## Value df p ## ───────────────────────────────────── ## χ² 6.461538 1 0.0110234 ## N 280 ## ───────────────────────────────────── We can see from the above output that the lowest expected frequency in cell “d” (expected number of premature birth in the urban region) is 2, which is less than 5. Thus, a Pearson’s chi-square test is not appropriate and we should conduct Fisher’s exact test. For doing this test, we should specify fisher = TRUE. Output from the test is shown below: Stata output 7.8: Cross-tabulation to compare the proportion of premature birth from two surveys contTables(data=babies, rows = region, cols = birth, counts = n, pcRow = TRUE, exp = TRUE, fisher = TRUE) ## ## CONTINGENCY TABLES ## ## Contingency Tables ## ───────────────────────────────────────────────────────────────────── ## region Premature Not premature Total ## ───────────────────────────────────────────────────────────────────── ## Urban Observed 2 198 200 ## Expected 5.000000 195.00000 200.00000 ## % within row 1.00000 99.00000 100.00000 ## ## Rural Observed 5 75 80 ## Expected 2.000000 78.00000 80.00000 ## % within row 6.25000 93.75000 100.00000 ## ## Total Observed 7 273 280 ## Expected 7.000000 273.00000 280.00000 ## % within row 2.50000 97.50000 100.00000 ## ───────────────────────────────────────────────────────────────────── ## ## ## χ² Tests ## ────────────────────────────────────────────────────── ## Value df p ## ────────────────────────────────────────────────────── ## χ² 6.461538 1 0.0110234 ## Fisher&#39;s exact test 0.0218217 ## N 280 ## ────────────────────────────────────────────────────── Here we see the proportion of premature birth in the urban area is only 1% and in the rural area it is 6%. The P-value from Fisher’s exact test is 0.022. Thus, we can conclude that there is evidence that the proportion of premature birth in the rural area is higher than that in the urban area. "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
